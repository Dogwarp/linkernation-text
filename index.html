<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>リンカーネイション即興小説テスト</title>
<style>
body { font-family: "Yu Gothic", sans-serif; background:#fdf6e3; padding:20px; }
h2 { color:#b58900; }
.thread { border:1px solid #ccc; padding:10px; margin-bottom:10px; }
.comment { margin-left:20px; border-top:1px dashed #ccc; padding:5px; }
button { margin-top:5px; }
</style>
</head>
<body>

<h1>即興小説スレッド（テスト版）</h1>

<div>
  <input type="text" id="newThreadTitle" placeholder="スレッドタイトル">
  <button onclick="addThread()">スレ立て</button>
</div>

<div id="threads"></div>

<script>
// 保存用
let threads = JSON.parse(localStorage.getItem("threads") || "[]");

// ページ初期化で復元
function renderThreads() {
    const container = document.getElementById("threads");
    container.innerHTML = "";
    threads.forEach((thread, tIndex) => {
        const div = document.createElement("div");
        div.className = "thread";
        div.innerHTML = `<h2>${thread.title}</h2>
                         <input type="text" placeholder="コメント" id="comment-${tIndex}">
                         <button onclick="addComment(${tIndex})">コメント</button>`;
        // コメント表示
        thread.comments.forEach((c, cIndex) => {
            const comDiv = document.createElement("div");
            comDiv.className = "comment";
            comDiv.innerHTML = `${c.text} <button onclick="likeComment(${tIndex},${cIndex})">👍 ${c.likes}</button>`;
            div.appendChild(comDiv);
        });
        container.appendChild(div);
    });
}

// スレ立て
function addThread() {
    const titleInput = document.getElementById("newThreadTitle");
    const title = titleInput.value.trim();
    if(!title) return;
    threads.push({title:title, comments:[]});
    titleInput.value = "";
    saveAndRender();
}

// コメント追加
function addComment(tIndex) {
    const input = document.getElementById(`comment-${tIndex}`);
    const text = input.value.trim();
    if(!text) return;
    threads[tIndex].comments.push({text:text, likes:0});
    input.value = "";
    saveAndRender();
}

// いいね
function likeComment(tIndex, cIndex){
    threads[tIndex].comments[cIndex].likes++;
    saveAndRender();
}

// 保存と再描画
function saveAndRender(){
    localStorage.setItem("threads", JSON.stringify(threads));
    renderThreads();
}

// 初期描画
renderThreads();
</script>

</body>
</html>
