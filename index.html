<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒªãƒ³ã‚«ãƒ¼ãƒã‚¤ã‚·ãƒ§ãƒ³ å³èˆˆã‚¹ãƒ¬ãƒƒãƒ‰</title>
<style>
  body { font-family: "Yu Gothic", sans-serif; background-color: #fdf6e3; padding: 20px; }
  h1 { color: #b58900; }
  .thread, .log-thread { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; }
  .comment { margin-left: 20px; padding: 5px; border-bottom: 1px dashed #ccc; }
  button { margin-left: 5px; }
</style>
</head>
<body>

<h1>ãƒªãƒ³ã‚«ãƒ¼ãƒã‚¤ã‚·ãƒ§ãƒ³ å³èˆˆã‚¹ãƒ¬ãƒƒãƒ‰</h1>
<div>
  <input type="text" id="newThreadTitle" placeholder="æ–°ã—ã„ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¿ã‚¤ãƒˆãƒ«">
  <button onclick="createThread()">ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆ</button>
  <button onclick="showLogs()">éå»ãƒ­ã‚°ï¼†ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
</div>
<div id="threads"></div>
<div id="logs" style="display:none;">
  <h2>éå»ãƒ­ã‚°ï¼†ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
  <div id="logThreads"></div>
</div>

<script>
let threads = [
  {title: "æ„šè€…ãŒæ—…ç«‹ã¤", comments: [], created: new Date()},
  {title: "æˆ¦è»Šã§æŒ‘ã‚€è‹±é›„", comments: [], created: new Date()}
];

function displayThreads() {
  const container = document.getElementById("threads");
  container.innerHTML = "";
  threads.forEach((thread, tIndex) => {
    const div = document.createElement("div");
    div.className = "thread";
    div.innerHTML = `<h2>${thread.title}</h2>
                     <input type="text" id="input-${tIndex}" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã„ã¦1åˆ†ä»¥å†…ã«æŠ•ç¨¿"/>
                     <button onclick="postComment(${tIndex})">æŠ•ç¨¿</button>
                     <span id="timer-${tIndex}"></span>`;
    
    // ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã„ã„ã­é †ã«è¡¨ç¤º
    thread.comments
      .sort((a,b) => b.likes - a.likes)
      .forEach((c, cIndex) => {
        const comDiv = document.createElement("div");
        comDiv.className = "comment";
        comDiv.innerHTML = `${c.text} <button onclick="likeComment(${tIndex},${cIndex})">ğŸ‘ ${c.likes}</button>`;
        div.appendChild(comDiv);
      });
    container.appendChild(div);
  });
}

function createThread() {
  const titleInput = document.getElementById("newThreadTitle");
  const title = titleInput.value.trim();
  if(title) {
    threads.push({title:title, comments:[], created: new Date()});
    titleInput.value = "";
    displayThreads();
  }
}

let timers = {};

function postComment(tIndex) {
  const input = document.getElementById(`input-${tIndex}`);
  const text = input.value.trim();
  if(!text) return;

  if(timers[tIndex]) {
    clearInterval(timers[tIndex].interval);
  }

  let timeLeft = 60;
  document.getElementById(`timer-${tIndex}`).textContent = `æ®‹ã‚Šæ™‚é–“: ${timeLeft}s`;
  
  timers[tIndex] = {interval: setInterval(() => {
    timeLeft--;
    document.getElementById(`timer-${tIndex}`).textContent = `æ®‹ã‚Šæ™‚é–“: ${timeLeft}s`;
    if(timeLeft <= 0) {
      clearInterval(timers[tIndex].interval);
      document.getElementById(`timer-${tIndex}`).textContent = `æŠ•ç¨¿æ™‚é–“çµ‚äº†`;
    }
  }, 1000)};

  threads[tIndex].comments.push({text:text, likes:0, created: new Date()});
  input.value = "";
  displayThreads();
}

function likeComment(tIndex, cIndex) {
  threads[tIndex].comments[cIndex].likes++;
  displayThreads();
}

// éå»ãƒ­ã‚°ï¼†ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
function showLogs() {
  const logDiv = document.getElementById("logs");
  const container = document.getElementById("logThreads");
  container.innerHTML = "";

  // ã„ã„ã­åˆè¨ˆé †ã§ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ã‚½ãƒ¼ãƒˆ
  const sortedThreads = threads.slice().sort((a,b) => {
    const aLikes = a.comments.reduce((sum,c)=>sum+c.likes,0);
    const bLikes = b.comments.reduce((sum,c)=>sum+c.likes,0);
    return bLikes - aLikes;
  });

  sortedThreads.forEach(thread => {
    const div = document.createElement("div");
    div.className = "log-thread";
    const totalLikes = thread.comments.reduce((sum,c)=>sum+c.likes,0);
    div.innerHTML = `<h3>${thread.title}ï¼ˆğŸ‘åˆè¨ˆ ${totalLikes}ï¼‰</h3>`;
    thread.comments
      .sort((a,b) => b.likes - a.likes)
      .forEach(c => {
        const cTime = new Date(c.created).toLocaleTimeString();
        const comDiv = document.createElement("div");
        comDiv.className = "comment";
        comDiv.textContent = `[${cTime}] ${c.text} ğŸ‘${c.likes}`;
        div.appendChild(comDiv);
      });
    container.appendChild(div);
  });

  logDiv.style.display = "block";
}

displayThreads();
</script>

</body>
</html>
