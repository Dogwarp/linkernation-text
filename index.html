<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>リンカーネイション オンライン版</title>
<style>
  body { font-family: "Yu Gothic", sans-serif; background-color: #fdf6e3; color: #333; padding: 20px; }
  h1, h2 { color: #b58900; }
  .thread { border: 1px solid #ccc; margin-bottom: 10px; padding: 10px; }
  .post { margin-left: 20px; margin-bottom: 5px; }
  button { margin-top: 5px; }
  input[type=text] { width: 80%; }
</style>
</head>
<body>

<h1>リンカーネイション オンライン版</h1>
<h2>スレッド一覧</h2>
<div id="threads"></div>

<h2>スレッド作成</h2>
<input type="text" id="threadTitle" placeholder="タイトルを入力">
<button onclick="createThread()">作成</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDdLmTIEgU3WNEN0Pr4fFNpQKjcYsmUXU8",
    authDomain: "linkernation-online.firebaseapp.com",
    databaseURL: "https://linkernation-online-default-rtdb.firebaseio.com",
    projectId: "linkernation-online",
    storageBucket: "linkernation-online.appspot.com",
    messagingSenderId: "398889265909",
    appId: "1:398889265909:web:33f569fc04e98350d6b3bc"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // スレッド作成
  function createThread() {
    const title = document.getElementById('threadTitle').value.trim();
    if (!title) return alert("タイトルを入力してください");
    const threadRef = db.ref('threads').push();
    threadRef.set({
      title: title,
      posts: {}
    });
    document.getElementById('threadTitle').value = "";
  }

  // 投稿作成
  function submitPost(threadID, authorInput, textInput) {
    const author = authorInput.value.trim() || "名無し";
    const text = textInput.value.trim();
    if (!text) return;
    const postRef = db.ref('threads/' + threadID + '/posts').push();
    postRef.set({
      author: author,
      text: text,
      timestamp: Date.now(),
      likes: 0
    });
    textInput.value = "";
  }

  // リアルタイム更新
  db.ref('threads').on('value', snapshot => {
    const threadsDiv = document.getElementById('threads');
    threadsDiv.innerHTML = "";
    const threads = snapshot.val() || {};
    for (const threadID in threads) {
      const thread = threads[threadID];
      const threadDiv = document.createElement('div');
      threadDiv.className = 'thread';
      const threadTitle = document.createElement('h3');
      threadTitle.textContent = thread.title;
      threadDiv.appendChild(threadTitle);

      // 投稿欄
      const authorInput = document.createElement('input');
      authorInput.type = 'text';
      authorInput.placeholder = '名前';
      threadDiv.appendChild(authorInput);

      const textInput = document.createElement('input');
      textInput.type = 'text';
      textInput.placeholder = '投稿内容';
      threadDiv.appendChild(textInput);

      const submitBtn = document.createElement('button');
      submitBtn.textContent = '投稿';
      submitBtn.onclick = () => submitPost(threadID, authorInput, textInput);
      threadDiv.appendChild(submitBtn);

      // 投稿表示
      const posts = thread.posts || {};
      for (const postID in posts) {
        const post = posts[postID];
        const postDiv = document.createElement('div');
        postDiv.className = 'post';
        postDiv.textContent = `${post.author}: ${post.text}`;
        threadDiv.appendChild(postDiv);
      }

      threadsDiv.appendChild(threadDiv);
    }
  });
</script>

</body>
</html>
