<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>リンカーネイション（駆け引き付き）</title>
<style>
  body { font-family: "Yu Gothic", sans-serif; background-color: #fdf6e3; color: #333; line-height: 1.6; padding: 20px; }
  h1,h2 { color: #b58900; }
  pre { background-color: #eee8d5; padding: 10px; border-radius: 5px; overflow-x: auto; }
  button, select, input { margin: 5px; padding: 5px 10px; }
  .hand { margin-bottom: 10px; }
</style>
</head>
<body>

<h1>リンカーネイション（駆け引き付きブラウザ版）</h1>

<section>
<h2>プレイヤー: Dogwarp</h2>
<div class="hand" id="playerHand"></div>
<label>役のカードを選択（番号カンマ区切り）:</label>
<input type="text" id="playerCards" placeholder="例: 3,16,32">
<br>
<label>物語:</label>
<input type="text" id="playerStory" placeholder="ここに物語を入力">
<br>
<label>駆け引き:</label>
<select id="playerMove">
  <option value="なし">なし</option>
  <option value="取引">運命の取引</option>
  <option value="強奪">運命の強奪</option>
</select>
<label>対象AI:</label>
<select id="targetAI">
  <option value="0">AI_アルタ</option>
  <option value="1">AI_ベラ</option>
</select>
<br>
<button onclick="playTurn()">ターン実行</button>
</section>

<section>
<h2>プレイログ</h2>
<pre id="log"></pre>
</section>

<script>
// カードデータ
const rnmCards = ["騎士","クローバー","船","家","木","雲","蛇","棺","花束","鎌","鞭","鳥","子供","狐","熊","星","コウノトリ","犬","塔","庭園","山","道","ネズミ","ハート","指輪","本","手紙","紳士","淑女","百合","太陽","月","鍵","魚","錨","十字架"];
const tarotCards = ["愚者","魔術師","女教皇","女帝","皇帝","教皇","恋人","戦車","力","隠者","運命の輪","正義","吊るされた男","死神","節制","悪魔","塔","星","月","太陽","審判","世界"];
let playerHand = [], aiHands = [], aiNames = ["AI_アルタ","AI_ベラ"], playerFragments = 0, aiFragments = [0,0];
const logEl = document.getElementById("log");

// ランダムカード配布
function drawCards(n){
  let deck = Array.from({length:36},(_,i)=>i+1);
  deck.sort(()=>Math.random()-0.5);
  return deck.slice(0,n);
}

// 初期手札
playerHand = drawCards(5);
aiHands = [drawCards(5), drawCards(5)];
document.getElementById("playerHand").innerText = "手札: " + playerHand.map(i=>rnmCards[i-1]).join(", ");

// ターン実行
function playTurn(){
  const worldCard = tarotCards[Math.floor(Math.random()*tarotCards.length)];

  // プレイヤー入力
  const cardInput = document.getElementById("playerCards").value.split(",").map(x=>parseInt(x.trim())).filter(x=>playerHand.includes(x));
  const story = document.getElementById("playerStory").value || "物語なし";

  const playerCreativity = Math.floor(Math.random()*6);
  const playerPersuasion = Math.floor(Math.random()*4);
  const playerFit = Math.floor(Math.random()*3);
  const playerPoint = playerCreativity + playerPersuasion + playerFit;
  playerFragments += playerPoint;

  logEl.textContent += `--- ターン ---\n`;
  logEl.textContent += `世界情勢: 【${worldCard}】\n`;
  logEl.textContent += `Dogwarp: 役【${cardInput.map(i=>rnmCards[i-1]).join("＋")}】\n`;
  logEl.textContent += `物語: ${story}\n`;
  logEl.textContent += `得点: 創造性${playerCreativity}点、説得力${playerPersuasion}点、適合性${playerFit}点\n`;
  logEl.textContent += `運命の欠片: ${playerFragments}枚\n\n`;

  // AIプレイヤー行動
  aiHands.forEach((hand,idx)=>{
    const aiCardCount = Math.floor(Math.random()*hand.length)+1;
    const aiCards = [];
    let tmpHand = hand.slice();
    for(let i=0;i<aiCardCount;i++){
      const choice = tmpHand.splice(Math.floor(Math.random()*tmpHand.length),1)[0];
      aiCards.push(choice);
    }
    const aiStory = `AIが${aiCards.map(i=>rnmCards[i-1]).join("＋")}で冒険しました。`;
    const aiCreativity = Math.floor(Math.random()*6);
    const aiPersuasion = Math.floor(Math.random()*4);
    const aiFit = Math.floor(Math.random()*3);
    const aiPoint = aiCreativity + aiPersuasion + aiFit;
    aiFragments[idx] += aiPoint;
    logEl.textContent += `${aiNames[idx]}: 役【${aiCards.map(i=>rnmCards[i-1]).join("＋")}】\n`;
    logEl.textContent += `物語: ${aiStory}\n`;
    logEl.textContent += `得点: 創造性${aiCreativity}点、説得力${aiPersuasion}点、適合性${aiFit}点\n`;
    logEl.textContent += `運命の欠片: ${aiFragments[idx]}枚\n\n`;
  });

  // 駆け引き判定
  const move = document.getElementById("playerMove").value;
  const target = parseInt(document.getElementById("targetAI").value);
  if(move !== "なし"){
    let success = Math.random() < 0.6; // 成功確率60%
    if(move === "強奪") success = Math.random() < 0.5; // 強奪は50%
    if(success && aiFragments[target]>0){
      aiFragments[target]--;
      playerFragments++;
      logEl.textContent += `駆け引き成功！Dogwarpは${aiNames[target]}から運命の欠片1枚獲得。\n\n`;
    } else {
      if(playerFragments>0) playerFragments--;
      logEl.textContent += `駆け引き失敗…Dogwarpの運命の欠片1枚失う。\n\n`;
    }
  }

  // ターン後リセット
  document.getElementById("playerCards").value = "";
  document.getElementById("playerStory").value = "";
}
</script>

</body>
</html>
