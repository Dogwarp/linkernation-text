<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>リンカーネイション 即興スレッド</title>
<style>
  body { font-family: "Yu Gothic", sans-serif; background-color: #fdf6e3; padding: 20px; }
  h1 { color: #b58900; }
  .thread { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; }
  .comment { margin-left: 20px; padding: 5px; border-bottom: 1px dashed #ccc; }
  button { margin-left: 5px; }
</style>
</head>
<body>

<h1>リンカーネイション 即興スレッド</h1>
<div>
  <input type="text" id="newThreadTitle" placeholder="新しいスレッドタイトル">
  <button onclick="createThread()">スレッド作成</button>
</div>
<div id="threads"></div>

<script>
let threads = [
  {title: "愚者が旅立つ", comments: []},
  {title: "戦車で挑む英雄", comments: []}
];

function displayThreads() {
  const container = document.getElementById("threads");
  container.innerHTML = "";
  threads.forEach((thread, tIndex) => {
    const div = document.createElement("div");
    div.className = "thread";
    div.innerHTML = `<h2>${thread.title}</h2>
                     <input type="text" id="input-${tIndex}" placeholder="コメントを書いて1分以内に投稿"/>
                     <button onclick="postComment(${tIndex})">投稿</button>
                     <span id="timer-${tIndex}"></span>`;
    
    // コメントをいいね順に表示
    thread.comments
      .sort((a,b) => b.likes - a.likes)
      .forEach((c, cIndex) => {
        const comDiv = document.createElement("div");
        comDiv.className = "comment";
        comDiv.innerHTML = `${c.text} <button onclick="likeComment(${tIndex},${cIndex})">👍 ${c.likes}</button>`;
        div.appendChild(comDiv);
      });
    container.appendChild(div);
  });
}

function createThread() {
  const titleInput = document.getElementById("newThreadTitle");
  const title = titleInput.value.trim();
  if(title) {
    threads.push({title:title, comments:[]});
    titleInput.value = "";
    displayThreads();
  }
}

// タイマー管理用オブジェクト
let timers = {};

function postComment(tIndex) {
  const input = document.getElementById(`input-${tIndex}`);
  const text = input.value.trim();
  if(!text) return;

  // タイマーが既にある場合は終了
  if(timers[tIndex]) {
    clearInterval(timers[tIndex].interval);
  }

  // 投稿と同時に1分タイマー開始
  let timeLeft = 60;
  document.getElementById(`timer-${tIndex}`).textContent = `残り時間: ${timeLeft}s`;
  
  timers[tIndex] = {interval: setInterval(() => {
    timeLeft--;
    document.getElementById(`timer-${tIndex}`).textContent = `残り時間: ${timeLeft}s`;
    if(timeLeft <= 0) {
      clearInterval(timers[tIndex].interval);
      document.getElementById(`timer-${tIndex}`).textContent = `投稿時間終了`;
    }
  }, 1000)};

  threads[tIndex].comments.push({text:text, likes:0});
  input.value = "";
  displayThreads();
}

function likeComment(tIndex, cIndex) {
  threads[tIndex].comments[cIndex].likes++;
  displayThreads();
}

displayThreads();
</script>

</body>
</html>
