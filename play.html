<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>リンカーネイション（テスト版）</title>
<style>
body { font-family: monospace; background:#fff; color:#000; padding:10px; }
input, textarea { width:100%; margin-top:5px; margin-bottom:5px; }
button { margin-top:5px; }
.post { border-top:1px solid #ccc; padding:5px 0; }
</style>
</head>
<body>

<h2>即興物語投稿（テスト版）</h2>

<label>名前:<br><input type="text" id="playerName"></label>
<p>お題: <span id="topic"></span></p>
<textarea id="story" placeholder="ここに物語を書こう"></textarea><br>
<button id="submitBtn">投稿</button>

<h3>投稿一覧</h3>
<div id="log"></div>

<script>
// ランダムお題リスト
const topics = ["森の中の冒険","未来都市の事件","忘れられた手紙","異世界の市場","不思議な出会い"];
document.getElementById("topic").textContent = topics[Math.floor(Math.random()*topics.length)];

// 保存・表示関数
function addPost(name, topic, story) {
    // 既存の投稿を取得（なければ空配列）
    let posts = JSON.parse(localStorage.getItem("posts") || "[]");

    // 新しい投稿を追加
    posts.push({name, topic, story, timestamp:Date.now()});

    // localStorageに保存
    localStorage.setItem("posts", JSON.stringify(posts));

    // 表示を更新
    showPosts();
}

// 投稿一覧を表示
function showPosts() {
    let posts = JSON.parse(localStorage.getItem("posts") || "[]");
    const log = document.getElementById("log");
    log.innerHTML = "";
    // 新しい投稿が上に来るよう逆順に表示
    posts.slice().reverse().forEach(p => {
        const div = document.createElement("div");
        div.className = "post";
        div.innerHTML = `<b>${p.name}</b> (${new Date(p.timestamp).toLocaleString()})<br>
                         お題: ${p.topic}<br>${p.story}`;
        log.appendChild(div);
    });
}

// ボタン押下時
document.getElementById("submitBtn").addEventListener("click", () => {
    const name = document.getElementById("playerName").value.trim();
    const story = document.getElementById("story").value.trim();
    const topic = document.getElementById("topic").textContent;

    if(!name || !story){ alert("名前と物語を入力してください"); return; }

    addPost(name, topic, story);

    // 入力欄をクリア
    document.getElementById("story").value = "";
    document.getElementById("playerName").value = "";
});
  
// 初回表示
showPosts();
</script>

</body>
</html>
